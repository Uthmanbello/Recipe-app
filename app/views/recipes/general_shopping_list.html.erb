<h1 class='text-center'>Shopping List</h1>

<section>
  <% if @recipe_foods.present? %>
    <% total_price = 0 %>
    <% item_count = 0 %>
    <% @recipe_foods.each do |recipe_food| %>
      <% recipe = Recipe.find(recipe_food.recipe_id) %>
      <%# <% recipe = Recipe.where(user_id = current_user.id) %> %>
      <% food = Food.find(recipe_food.food_id) %>
      <% total_price += food.price * (recipe_food.quantity - food.quantity) %>
      <% item_count += 1 %>
    <div class='d-flex justify-content-around'>
      <p>Amount of food items to buy: <%= item_count %></p>
      <p>Total value of food needed: &dollar; <%= total_price %></p>
    </div>
    <table class="table table-striped table-hover">
      <tr>
        <th  class="text-center" scope="col">Food</th>
        <th class="text-center">Quantity</th>
        <th class="text-center">Price</th>
      </tr>
        <tr>
          <td class="text-center"><%= food.name %></td>
          <td class="text-center"><%= (recipe_food.quantity - food.quantity) %>&nbsp;<%= food.measure_unit %></td>
          <td class="text-center">$<%= food.price * (recipe_food.quantity - food.quantity) %></td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <p>No shopping list available.</p>
  <% end %>
</section>


<section class="container">
  <p style="color: green"><%= notice %></p>
  <h1 class="mb-5">Foods for user: <%=current_user.name%></h1>
  <table class="table table-striped table-hover ">
    <tr>
      <th  class="text-center" scope="col">Food</th>
      <th class="text-center">Measurement Unit</th>
      <th class="text-center">Unit Price</th>
      <th class="text-center">Quantity</th>
      <th class="text-center">Actions</th>
    </tr>
    <% @foods.each do |food| %>
      <tr>
        <td class="text-center" ><%= link_to food.name, food %></td>
        <td class="text-center"><%= food.measure_unit %></td>
        <td class="text-center">$<%= food.price %></td>
        <td class="text-center"><%= food.quantity %></td>
        <td class="text-center"><%= button_to "Delete this food", food, method: :delete, class: "bi bi-trash3 btn btn-outline-danger btn-sm" %></td>
      </tr>
    <% end %>
  </table>
  <i class="bi bi-plus-circle btn btn-primary link-light">
    <%= link_to "New food", new_food_path, class:"link-light p-1" %>
  </i>
</section>
